<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">
	
<mapper namespace="myjourney.Myjourney">
	<insert id="Startinsertjourney">
	insert into myjourney (jnum,id,xpos,ypos,cate,ref,turn,jdate)
	values(myj_seq.nextval,#{id},#{xpos},#{ypos},#{cate},#{ref},#{turn},#{jdate})
	</insert>
	<insert id="insertjourney">
	insert into myjourney (jnum,id,xpos,ypos,cate,ref,turn,jdate)
	values(#{jnum},#{id},#{xpos},#{ypos},#{cate},#{ref},#{turn},#{jdate})
	</insert>
	
	
	<select id="myjSelect" resultType="myjourney.model.MyJourneyBean">
	SELECT
    m.jnum, m.id, m.xpos, m.ypos, m.cate, m.ref, m.turn, m.jdate,
    COALESCE(s.name, r.name, h.name, c.name) AS name,
    COALESCE(s.address, r.address, h.address, c.address) AS address,
    COALESCE(s.image, r.image, h.image, c.image) AS image,
    COALESCE(s.image2, r.image2, h.image2, c.image2) AS image2,
    COALESCE(s.image3, r.image3, h.image3, c.image3) AS image3,
    COALESCE(s.image4, r.image4, h.image4, c.image4) AS image4,
    COALESCE(s.image5, r.image5, h.image5, c.image5) AS image5
FROM
    myjourney m
LEFT JOIN spot s ON m.ref = s.snum AND m.cate = 'spot'
LEFT JOIN rest r ON m.ref = r.rnum AND m.cate = 'restaurant'
LEFT JOIN hotel h ON m.ref = h.hnum AND m.cate = 'hotel'
LEFT JOIN cafe c ON m.ref = c.cnum AND m.cate = 'cafe'
WHERE
    m.id = 'admin'
   order by m.jdate ,turn 
		</select>
	
</mapper>		